# Sub-Agent 使用规范

**注意：仅在用户明确要求"委托"时使用此规范，不要主动委托**

---

## 何时使用

用户说以下内容时启用：
- "委托: xxx"
- "让 sub-agent 去做"
- "并行处理这几个任务"

## 核心原则

### 1. 文件通信
- Sub-Agent 之间通过**文件**传递数据
- 不要把大段内容放进返回消息
- 分析报告写入 `workspace/`

### 2. 保护上下文
主 Agent 上下文只接收：
- 状态（成功/失败）
- 文件路径
- 需要决策的问题（简短）

不要接收：
- 完整代码
- 大段文档
- 原始数据

### 3. 返回规范（4 行）

```
状态：已完成 / 失败 / 需要决策
报告：workspace/X.Y-xxx.md
产出：N 个文件（列出路径）
决策点：[如有，一句话描述]
```

## 任务编号

| 编号 | 含义 |
|------|------|
| X.0 | 主 Agent 产出（规划、决策） |
| X.1, X.2... | 第 X 阶段的 Sub-Agent 任务 |
| 同一 X | 可并行执行 |
| X 递增 | 串行依赖 |

## 委托模板

```
任务 {X.Y}: {任务名}

目标：{清晰的单一职责}

输入：
- {文件路径或上下文}

产出：
- 代码：{写入路径}
- 报告：workspace/{X.Y}-报告.md

要求：
- 使用 Write 工具写入文件
- 只返回 4 行摘要
```

## 示例

```
用户: "委托：分析 src/ 下所有模块的依赖关系，同时检查测试覆盖率"

主 Agent:
  → 拆分为两个并行任务

  任务 1.1: 依赖分析
  目标：分析 src/ 下模块间的 import 关系，生成依赖图
  产出：workspace/1.1-dependency-report.md

  任务 1.2: 测试覆盖率
  目标：统计每个模块的测试覆盖情况
  产出：workspace/1.2-coverage-report.md

Sub-Agent 1.1 返回:
  状态：已完成
  报告：workspace/1.1-dependency-report.md
  产出：1 个文件
  决策点：无

Sub-Agent 1.2 返回:
  状态：已完成
  报告：workspace/1.2-coverage-report.md
  产出：1 个文件
  决策点：3 个模块覆盖率为 0%，是否需要补充测试？
```
